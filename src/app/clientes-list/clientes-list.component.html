
<!-- Header breadcrumb como componente shared -->
<app-breadcrumb [items]="[
  { label: 'Inicio', link: '/' },
  { label: 'Administración', link: '/' },
  { label: 'Clientes' }
]"></app-breadcrumb>
<div class="card mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex gap-2 align-items-center">
        <h2 class="mb-0">Clientes</h2>
        <div class="input-group ms-3">
          <input type="text" class="form-control form-control-sm" placeholder="Buscar por nombre o número" [(ngModel)]="filtro" (keyup)="aplicarFiltro()">
          <button class="btn btn-outline-secondary btn-sm" type="button" (click)="limpiarFiltro()">Limpiar</button>
        </div>
      </div>
      <div class="d-flex">
        <button class="btn btn-outline-secondary btn-sm me-2" (click)="cargarClientes()" title="Refrescar">⟳</button>
        <button class="btn btn-primary" (click)="mostrarFormularioNuevo()">Nuevo Cliente</button>
      </div>
    </div>
    <div class="table-responsive">
      <div *ngIf="!mostrarFormNuevo">
        <table class="table table-striped table-hover">
        <thead class="thead-light">
          <tr>
            <th>ID</th>
            <th>Tipo</th>
            <th>Numero</th>
            <th>Nombre/Razón Social</th>
            <th>Provincia</th>
            <th>Localidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of clientesEnPagina">
            <td>{{cliente.ClienteID}}</td>
            <td>{{cliente.TIPO}}</td>
            <td>{{cliente.Numero}}</td>
            <td>{{cliente.NombreRazonSocial}}</td>
            <td>{{ cliente.Provincia || '-' }}</td>
            <td>{{ cliente.Ciudad || '-' }}</td>
            <td>
              <button class="btn btn-info btn-sm mx-1" (click)="selectCliente(cliente)" title="Ver Datos"><i class="bi bi-eye"></i></button>
              <button class="btn btn-warning btn-sm mx-1" (click)="editarCliente(cliente)" title="Editar"><i class="bi bi-pencil-square"></i></button>
              <button class="btn btn-danger btn-sm mx-1" (click)="deleteCliente(cliente.ClienteID)" title="Eliminar"><i class="bi bi-trash"></i></button>
              <a class="btn btn-success btn-sm mx-1" [routerLink]="['/notas/crear', cliente.ClienteID]" title="Nota Pedido"><i class="bi bi-journal-plus"></i></a>
            </td>
          </tr>
          <tr *ngIf="clientesFiltrados.length === 0">
            <td colspan="7" class="text-center text-muted">No hay clientes para mostrar.</td>
          </tr>
        </tbody>
        </table>
        <div *ngIf="!clientesFiltrados.length" class="p-3 text-center text-muted">No hay clientes. Usa 'Nuevo Cliente' para crear uno.</div>

        <!-- Paginación corregida -->
        <nav *ngIf="totalPages > 1" class="mt-3 d-flex justify-content-between align-items-center">
          <div>
            Mostrando {{ startIndex }} - {{ endIndex }} de {{ totalPages * pageSize > endIndex ? endIndex : totalPages * pageSize }} clientes
          </div>
          <ul class="pagination mb-0">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="prevPage()">Anterior</button>
            </li>
            <li class="page-item" *ngFor="let p of pageArray" [class.active]="currentPage === p">
              <button class="page-link" (click)="goToPage(p)">{{p}}</button>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" (click)="nextPage()">Siguiente</button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  <app-cliente-form *ngIf="mostrarFormNuevo || clienteEditando !== null" [cliente]="clienteEditando || nuevoCliente" (guardado)="onGuardado()" (cancelado)="manejarCancelado()"></app-cliente-form>
  <app-datos-clientes-list *ngIf="selectedCliente" [clienteId]="selectedCliente.ClienteID"></app-datos-clientes-list>
  </div>
</div>
